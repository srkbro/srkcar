<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Driver Dashboard â€” Car Rent Manager</title>
<link rel="icon" href="data:,">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0f172a; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4; --glass: rgba(255,255,255,0.03);
  --white: #e6eef8; --radius:14px; --gap:12px; --max-width:900px; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#071028 0%, #071426 100%);color:var(--white);-webkit-font-smoothing:antialiased;}
.container{max-width:var(--max-width);margin:18px auto;padding:14px;}
.header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:12px;}
.brand{display:flex;gap:12px;align-items:center;}
.logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#06b6d4,#3b82f6);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021426;font-size:18px;overflow:hidden;}
.logo img{width:100%;height:100%;object-fit:contain;display:block;}
.title{font-size:16px;font-weight:700;}
.sub{color:var(--muted);font-size:13px;}
.grid{display:grid;grid-template-columns:1fr;gap:var(--gap);}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:var(--radius);backdrop-filter: blur(6px);border:1px solid rgba(255,255,255,0.03);}
.form-row{display:flex;gap:8px;align-items:center;margin-bottom:8px;}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white);font-size:14px;}
.btn{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600;}
.btn-primary{background:linear-gradient(90deg,#06b6d4,#3b82f6);color:#021426;}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--white)}
.stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;}
.stat{padding:12px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);}
.stat .label{font-size:12px;color:var(--muted);}
.stat .value{font-size:18px;font-weight:700;margin-top:6px;}
@media(min-width:700px){ .stats{grid-template-columns:repeat(4,1fr);} }
.charts{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px;}
@media(min-width:860px){ .charts{grid-template-columns:1fr 1fr;} }
.entries-list{display:grid;gap:10px;}
.entry-card{padding:10px;border-radius:12px;background:var(--card);border:1px solid rgba(255,255,255,0.03);}
.entry-row{display:flex;justify-content:space-between;align-items:center;gap:8px;}
.entry-meta{display:flex;flex-direction:column;gap:6px;}
.small{font-size:13px;color:var(--muted);}
.table-wrap{display:none;background:transparent;}
@media(min-width:860px){ .entries-list{display:none;} .table-wrap{display:block;background:transparent;} table{width:100%;border-collapse:collapse;color:var(--white);font-size:14px;} th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left;} th{font-size:12px;color:var(--muted);} td{font-size:13px;} }
.footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px;}
.kv{font-size:12px;color:var(--muted);}
.actions{display:flex;gap:8px;}
.icon-btn{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px;border-radius:8px;color:var(--white);cursor:pointer}
.driver-percent{width:84px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--white);text-align:center}
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand">
        <div class="logo">
          <!-- Embedded logo image -->
          <img alt="logo" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABAAAAAQACAIAAADwf7zUAAAAAXNSR0IArs4c6QAâ€¦(truncated here for brevity)"/>
        </div>
        <div>
          <div class="title">Driver Dashboard</div>
          <div class="sub">Car Rent Manager â€” Mobile UI</div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="text-align:right">
          <div class="kv">Entries</div>
          <div id="entryCount" style="font-weight:700">0</div>
        </div>
        <button class="icon-btn" id="exportBtn" title="Export">â¤“</button>
      </div>
    </div>

    <div class="grid">

      <!-- Form Card -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <div style="font-weight:700">Add / Edit Entry</div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="kv">Driver %</label>
            <input id="driverPercent" class="driver-percent" type="number" min="0" max="100" value="40" />
          </div>
        </div>

        <form id="entryForm" style="display:grid;gap:8px;">
          <input class="input" id="date" type="date" required />
          <input class="input" id="driver" placeholder="Driver name" required />
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
            <input class="input" id="rent" placeholder="Rent" type="number" />
            <input class="input" id="fuel" placeholder="Fuel" type="number" />
            <input class="input" id="extra" placeholder="Extra" type="number" />
          </div>
          <input class="input" id="notes" placeholder="Notes (optional)" />
          <div style="display:flex;gap:8px;">
            <button class="btn btn-primary" type="submit">Save</button>
            <button class="btn btn-ghost" type="button" id="resetBtn">Reset</button>
            <button class="btn btn-ghost" type="button" id="importBtn">Import</button>
          </div>
        </form>
      </div>

      <!-- Stats card -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <div style="font-weight:700">Overview</div>
          <div class="small">Live numbers</div>
        </div>

        <div class="stats" style="margin-top:10px;">
          <div class="stat">
            <div class="label">Total Income</div>
            <div class="value" id="totalIncome">0</div>
          </div>
          <div class="stat">
            <div class="label">Total Expense</div>
            <div class="value" id="totalExpense">0</div>
          </div>
          <div class="stat">
            <div class="label">Profit</div>
            <div class="value" id="profit">0</div>
          </div>
          <div class="stat">
            <div class="label">Driver Income</div>
            <div class="value" id="driverShare">0</div>
          </div>
        </div>

        <div class="charts">
          <div style="padding-top:8px;">
            <canvas id="dailyChart" height="160"></canvas>
          </div>
          <div style="padding-top:8px;">
            <canvas id="driverChart" height="160"></canvas>
          </div>
        </div>
      </div>

      <!-- Entries list (mobile) -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <div style="font-weight:700">Entries</div>
          <div class="small">Tap item to edit</div>
        </div>

        <div class="entries-list" id="entriesList"></div>

        <div class="table-wrap" id="tableWrap" style="margin-top:8px;">
          <table>
            <thead><tr><th>Date</th><th>Driver</th><th>Rent</th><th>Fuel</th><th>Extra</th><th>Profit</th><th>Driver</th></tr></thead>
            <tbody id="entriesTable"></tbody>
          </table>
        </div>
      </div>

      <div class="footer card">Made for Swadhin â€” mobile-first responsive dashboard</div>
    </div>
  </div>

<input type="file" id="importJson" accept=".json" style="display:none">

<script>
(function(){
  const STORAGE_KEY = 'driver_dashboard_entries_v1';
  const SETTINGS_KEY = 'driver_dashboard_settings_v1';

  let entries = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  let editingId = null;

  // DOM refs
  const entryCountEl = document.getElementById('entryCount');
  const entriesList = document.getElementById('entriesList');
  const entriesTable = document.getElementById('entriesTable');
  const dateEl = document.getElementById('date');
  const driverEl = document.getElementById('driver');
  const rentEl = document.getElementById('rent');
  const fuelEl = document.getElementById('fuel');
  const extraEl = document.getElementById('extra');
  const notesEl = document.getElementById('notes');
  const driverPercentEl = document.getElementById('driverPercent');
  const totalIncomeEl = document.getElementById('totalIncome');
  const totalExpenseEl = document.getElementById('totalExpense');
  const profitEl = document.getElementById('profit');
  const driverShareEl = document.getElementById('driverShare');
  const importJson = document.getElementById('importJson');

  // charts
  let dailyChart, driverChart;

  function format(n){ return Number(n).toLocaleString(); }

  // load percent from settings
  try{
    const s = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
    if(s.driverPercent !== undefined) driverPercentEl.value = s.driverPercent;
  }catch(e){}

  driverPercentEl.addEventListener('change', ()=>{
    const v = Number(driverPercentEl.value) || 0;
    localStorage.setItem(SETTINGS_KEY, JSON.stringify({driverPercent:v}));
    render();
    updateStats();
  });

  function saveEntries(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); }

  document.getElementById('entryForm').addEventListener('submit', (ev)=>{
    ev.preventDefault();
    if(!driverEl.value.trim()){ alert('Driver name required'); return; }
    const obj = {
      id: editingId || Date.now(),
      date: dateEl.value || new Date().toISOString().slice(0,10),
      driver: driverEl.value.trim(),
      rent: Number(rentEl.value)||0,
      fuel: Number(fuelEl.value)||0,
      extra: Number(extraEl.value)||0,
      notes: notesEl.value||''
    };
    if(editingId){ entries = entries.map(x=> x.id===editingId ? obj : x); editingId = null; } else { entries.unshift(obj); }
    saveEntries(); document.getElementById('entryForm').reset(); dateEl.value = new Date().toISOString().slice(0,10);
    render(); updateStats(); window.scrollTo({top:0,behavior:'smooth'});
  });

  document.getElementById('resetBtn').addEventListener('click', ()=>{ document.getElementById('entryForm').reset(); editingId = null; dateEl.value = new Date().toISOString().slice(0,10); });

  document.getElementById('importBtn').addEventListener('click', ()=> importJson.click());
  importJson.addEventListener('change', function(){
    const f = this.files[0]; if(!f) return;
    const r = new FileReader();
    r.onload = (e)=>{ try{ const data = JSON.parse(e.target.result); if(!Array.isArray(data)) throw 'Invalid'; entries = data.concat(entries); saveEntries(); render(); updateStats(); alert('Imported'); }catch(err){ alert('Invalid JSON file'); } };
    r.readAsText(f); this.value='';
  });

  document.getElementById('exportBtn').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(entries,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download='driver_entries.json'; a.click(); URL.revokeObjectURL(url);
  });

  window.editEntry = function(id){
    const e = entries.find(x=>x.id===id); if(!e) return;
    editingId = id; dateEl.value = e.date; driverEl.value = e.driver; rentEl.value = e.rent; fuelEl.value = e.fuel; extraEl.value = e.extra; notesEl.value = e.notes;
    window.scrollTo({top:0,behavior:'smooth'});
  };

  window.deleteEntry = function(id){
    if(!confirm('Delete?')) return;
    entries = entries.filter(x=> x.id!==id); saveEntries(); render(); updateStats();
  };

  // charts init
  function initCharts(){
    const ctx1 = document.getElementById('dailyChart').getContext('2d');
    dailyChart = new Chart(ctx1, {
      type:'line',
      data:{ labels:[], datasets:[ {label:'Income', data:[], fill:false, tension:0.3}, {label:'Expense', data:[], fill:false, tension:0.3} ] },
      options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} }
    });

    const ctx2 = document.getElementById('driverChart').getContext('2d');
    driverChart = new Chart(ctx2, {
      type:'bar',
      data:{ labels:[], datasets:[ {label:'Income', data:[]}, {label:'Expense', data:[]} ] },
      options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} }
    });
  }

  function updateStats(){
    const totals = {income:0,fuel:0,extra:0};
    entries.forEach(e=>{ totals.income += e.rent; totals.fuel += e.fuel; totals.extra += e.extra; });
    totals.expense = totals.fuel + totals.extra; totals.profit = totals.income - totals.expense;
    totalIncomeEl.textContent = format(totals.income);
    totalExpenseEl.textContent = format(totals.expense);
    profitEl.textContent = format(totals.profit);
    const percent = Number(driverPercentEl.value)||40; const dShare = Math.max(0, Math.round(totals.profit * percent / 100));
    driverShareEl.textContent = format(dShare);
    const daily = {};
    entries.forEach(e=>{ if(!daily[e.date]) daily[e.date] = {income:0,expense:0}; daily[e.date].income += e.rent; daily[e.date].expense += (e.fuel + e.extra); });
    const dates = Object.keys(daily).sort();
    dailyChart.data.labels = dates; dailyChart.data.datasets[0].data = dates.map(d=>daily[d].income); dailyChart.data.datasets[1].data = dates.map(d=>daily[d].expense); dailyChart.update();
    const drivers = {};
    entries.forEach(e=>{ if(!drivers[e.driver]) drivers[e.driver] = {income:0,expense:0}; drivers[e.driver].income += e.rent; drivers[e.driver].expense += (e.fuel + e.extra); });
    const dNames = Object.keys(drivers);
    driverChart.data.labels = dNames; driverChart.data.datasets[0].data = dNames.map(n=>drivers[n].income); driverChart.data.datasets[1].data = dNames.map(n=>drivers[n].expense); driverChart.update();
  }

  function render(){
    entryCountEl.textContent = entries.length;
    entriesList.innerHTML = '';
    entries.forEach(e=>{
      const profit = e.rent - (e.fuel + e.extra);
      const percent = Number(driverPercentEl.value)||40;
      const dShare = Math.max(0, Math.round(profit * percent / 100));
      const card = document.createElement('div'); card.className='entry-card';
      card.innerHTML = `
        <div class="entry-row">
          <div class="entry-meta">
            <div style="font-weight:700">${e.driver}</div>
            <div class="small">${e.date} Â· ${format(e.rent)}</div>
          </div>
          <div style="text-align:right">
            <div style="font-weight:700">Profit: ${format(profit)}</div>
            <div class="small">Driver: ${format(dShare)}</div>
          </div>
        </div>
        <div style="display:flex;justify-content:space-between;margin-top:8px;align-items:center">
          <div class="small">${e.notes||''}</div>
          <div class="actions">
            <button class="icon-btn" onclick="editEntry(${e.id})">âœŽ</button>
            <button class="icon-btn" onclick="deleteEntry(${e.id})">ðŸ—‘</button>
          </div>
        </div>
      `;
      card.addEventListener('click', function(ev){ if(ev.target.tagName.toLowerCase() !== 'button') editEntry(e.id); });
      entriesList.appendChild(card);
    });
    entriesTable.innerHTML = '';
    entries.forEach(e=>{
      const profit = e.rent - (e.fuel + e.extra);
      const percent = Number(driverPercentEl.value)||40;
      const dShare = Math.max(0, Math.round(profit * percent / 100));
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.date}</td><td>${e.driver}</td><td>${format(e.rent)}</td><td>${format(e.fuel)}</td><td>${format(e.extra)}</td><td>${format(profit)}</td><td>${format(dShare)}</td>`;
      entriesTable.appendChild(tr);
    });
    updateStats();
  }

  initCharts = function(){};
  // initialize charts properly after DOM load
  (function(){ 
    const ctx1 = document.getElementById('dailyChart').getContext('2d');
    dailyChart = new Chart(ctx1, { type:'line', data:{ labels:[], datasets:[ {label:'Income', data:[], fill:false, tension:0.3}, {label:'Expense', data:[], fill:false, tension:0.3} ] }, options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} } });
    const ctx2 = document.getElementById('driverChart').getContext('2d');
    driverChart = new Chart(ctx2, { type:'bar', data:{ labels:[], datasets:[ {label:'Income', data:[]}, {label:'Expense', data:[]} ] }, options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}} } });
  })();

  // init render
  render(); updateStats();

  // expose window helpers
  window.editEntry = function(id){ const e = entries.find(x=>x.id===id); if(!e) return; editingId = id; dateEl.value=e.date; driverEl.value=e.driver; rentEl.value=e.rent; fuelEl.value=e.fuel; extraEl.value=e.extra; notesEl.value=e.notes; window.scrollTo({top:0,behavior:'smooth'}); }
  window.deleteEntry = function(id){ if(!confirm('Delete?')) return; entries = entries.filter(x=> x.id!==id); localStorage.setItem(STORAGE_KEY, JSON.stringify(entries)); render(); updateStats(); }

})();
</script>
</body>
</html>
